<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="#">Super Loja</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" href="categorias.html">Categorias</a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" href="ofertas.html">Ofertas</a>
            </li>
            </ul>
        </div>
    </nav>
    
    <div class="container">
        <div class="table-responsive-sm">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>codCategoria</th>
                        <th>titulo</th>
                        <th>descricao</th>
                        <th>valor</th>
                        <th>quantidade</th>
                        <th>imagem</th>
                        <th>nome</th>
                        <th>email</th>
                        <th>senha</th>
                        <th>endereco</th>
                        <th>complemento</th>
                        <th>cidade</th>
                        <th>estado</th>
                        <th>cep</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
            </table>        
        </div>
        
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>    

    <script>
        var url = "https://clienteweb2017.000webhostapp.com/loja/oferta/";
        var loja = "43406E41981A";

        

        $(document).ready(function() {
            buscarDados();
            
            function buscarDados() {
                $.get(url+"getOfertas.php?loja="+loja)
                .done(function(data){
                    var obj = JSON.parse(data)
                    montarLinhas(obj.ofertas);
                    $("#divForm").slideUp();
                })
                .fail(function(){
                alert("falha");
                });
                
            }  	
            function incluirDados() {			
                $.get(url+"createCategoria.php?nome=" + $("#frmNome").val()+"&loja="+ loja)
                .done(function(data){
                    console.log(data);
                    buscarDados();
                })
                .fail(function(){
                alert("falha");
                });		
            }  	
            function alterarDados() {			
                $.get(url+"updateCategoria.php?codigo="+ $("#frmCategoriaCodigo").val() +"&nome=" + $("#frmNome").val() + "&loja="+loja)
                .done(function(data){
                    console.log(data);
                    buscarDados();
                })
                .fail(function(){
                alert("falha");
                });		
            }  	
            function montarLinhas(data) {
                $("#tableBody").empty();
                $.each(data, function( key, value ) {
                    $("#tableBody")
                        .append($("<tr />")
                            .append($("<td />").text(value.codCategoria))
                            .append($("<td />").text(value.titulo))
                            .append($("<td />").text(value.descricao))
                            .append($("<td />")
                                .append($("<a />")
                                    .text("Editar")
                                    .attr("href", "#")
                                    .attr("class", "clseditar")
                                )
                            )
                            .append($("<td />")
                                .append($("<a />")
                                    .text("Excluir")
                                    .attr("href", "#")
                                    .attr("class", "clsexcluir")
                                )
                            )
                        );		
                });
            }
            $("body").on("click",".clseditar",function(){
                    //console.log($(this).parent().siblings().eq(0).text());

                    var codigo = $(this).parent().siblings().eq(0).text();
                    var nome = $(this).parent().siblings().eq(1).text();
                    
                    $("#frmCategoriaCodigo").val(codigo);
                    $("#frmNome").val(nome);
                    $("#divForm").slideDown();
            });	
            $("body").on("click",".clsexcluir",function(){
            
                $.get(url+"deleteCategoria.php?loja=" + loja+ "&codigo="+ $(this).parent().siblings().eq(0).text())
                .done(function(data){
                    console.log(data);
                    buscarDados();
                })
                .fail(function(){
                alert("falha");
                });
            });		
            $("#incluirAlterarCategoria").click(function(){
            if ($("#frmCategoriaCodigo").val() !=""){
                    alterarDados();
                }else{
                    incluirDados();
                }
            });	

            $("#novoCategoria").click(function(){
                    $("#frmCategoriaCodigo").val("");
                    $("#frmNome").val("");
            $("#divForm").slideToggle();
            });
        });
    </script>
</body>
</html>